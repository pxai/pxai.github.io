---
layout: post
title: "WebServices con java y eclipse" 
date: 2013-07-27 16:38:31 
categories: coding
---
<p>Los WebServices son un gran invento. Son programas que permiten el intercambio de datos entre otros programas que pueden estar escritos en cualquier lenguaje y montados en cualquier entorno. Todo el protocolo de comunicaciones (el <a href="https://es.wikipedia.org/wiki/SOAP">SOAP</a>) y los lenguajes utilizados (basados en XML) son estándares abiertos que pueden ser asimilados por el que quiera. Y lo bueno es que todos han querido. La cosa es que podemos tener montado un  servicio web en java y este puede ser consumido por un cliente php, c# o incluso java. Y viceversa. Vamos, esto es lo que prometía Corba, pero más factible y todo montado sobre la web y el puerto tcp que es el rey: el 80.
</p><p>
Desarrollar un WebService con java usando un IDE es aglo bastante sencillo. Ya sea con Eclipse o con Netbeans nos lo da todo prácticamente hecho a golpe de asistentes. Casi de lo único que nos tenemos que preocupar es de programar una clase que luego exportaremos como Servicio Web.
</p>

<p>
<b>1. Desarrollar un proyecto java normal con clases normales</b>
</p>
<p>En este caso en un proyecto java normal llamado DreddQuotes  he creado una clase muy simplona que lo único que hace es soltar frases del gran juez Dredd. </p>
<p>Todo eso creando un proyecto java normal y corriente</p>
<em>DreddSays.java</em>
<pre class="brush: java;">

package info.pello.dredd;

import java.util.Random;
import java.util.Vector;

/**
 * represents the law...
 * @author Pello Xabier Altadill Izura
 * @greetz picajosians
 */
public class DreddSays {
	private Vector<String> quotes = new Vector<String>();
	private Random random = new Random();
	
	/**
	 * default constructor
	 */
	public DreddSays () {
		init();
	}

	/**
	 * inits quotes
	 */
	private void init () {
		quotes.add("Compile error: automatic fail.");
		quotes.add("Unit test error: automatic fail.");
		quotes.add("Stallone is not the law. I'm the law.");
		quotes.add("You have been warned.");
		quotes.add("Judgement time...");
	}
	
	/**
	 * gets random phrase from quote vector
	 * @return random quote
	 */
	public String randomQuote () {
		return quotes.get(random.nextInt(quotes.size()));
	}
}

</pre>
<p>
<b>2. Crear un proyecto "Dynamic Web Project"</b> para publicar el servicio web. No hacer nada, simplemente crearlo.
</p>
<p>
<b>3. Crear un proyecto java normal</b> para meter ahí un cliente de nuestro servicio web. No hacer nada, simplemente crearlo.
</p>
<p>
<b>4. Sobre el proyecto DreddQuotes seleccionamos</b> <em>File > New > WebService > WebService</em>, y esto iniciará el asistente de webservices.
<img src="http://www.pello.info/images/configwebservice.png" alt="asistente para webservices en Eclipse kepler" title="asistente para webservices en Eclipse kepler" />
<p>
Ahí es donde podemos indicar:
<ul>
 <li>Qué clase va a servir como WebService (seleccionamos DreddSays)</li>
 <li>El proyecto web dinámico donde publicaremos el webservice y el servidor a utilizar (en mi caso con el tomcat7)</li>
 <li>El proyecto java donde se generará el cliente de nuestro webservice</li>
</ul>
 </p>

<p><b>5. A partir de ahí el asistente inicia una serie de pasos</b> con opciones, no hace falta cambiar nada.
</p>

<p>
Ya tenemos nuestro WebService publicado por tomcat. En mi caso lo ha publicado en una aplicación web dinámica llamada adibidea
y la puedo ver en http://localhost:8080/Adibidea/services/DreddSays
</p>
<p>
Si queremos que nos vuelque el WSDL (un XML que contiene la definición de nuestro servicio web), basta con hacer lo siquiente:
http://localhost:8080/Adibidea/services/DreddSays?wsdl
</p>
Lo cual volcará:
<pre class="brush: xml;">
<?xml version="1.0" encoding="UTF-8"?>
<wsdl:definitions targetNamespace="http://dredd.pello.info" xmlns:apachesoap="http://xml.apache.org/xml-soap" xmlns:impl="http://dredd.pello.info" xmlns:intf="http://dredd.pello.info" xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/" xmlns:wsdlsoap="http://schemas.xmlsoap.org/wsdl/soap/" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
<!--WSDL created by Apache Axis version: 1.4
Built on Apr 22, 2006 (06:55:48 PDT)-->
 <wsdl:types>
  <schema elementFormDefault="qualified" targetNamespace="http://dredd.pello.info" xmlns="http://www.w3.org/2001/XMLSchema">
   <element name="randomQuote">
    <complexType/>
   </element>
   <element name="randomQuoteResponse">
    <complexType>
     <sequence>
      <element name="randomQuoteReturn" type="xsd:string"/>
     </sequence>
    </complexType>
   </element>
  </schema>
 </wsdl:types>
   <wsdl:message name="randomQuoteResponse">
      <wsdl:part element="impl:randomQuoteResponse" name="parameters">
      </wsdl:part>
   </wsdl:message>
   <wsdl:message name="randomQuoteRequest">
      <wsdl:part element="impl:randomQuote" name="parameters">
      </wsdl:part>
   </wsdl:message>
   <wsdl:portType name="DreddSays">
      <wsdl:operation name="randomQuote">
         <wsdl:input message="impl:randomQuoteRequest" name="randomQuoteRequest">
       </wsdl:input>
         <wsdl:output message="impl:randomQuoteResponse" name="randomQuoteResponse">
       </wsdl:output>
      </wsdl:operation>
   </wsdl:portType>
   <wsdl:binding name="DreddSaysSoapBinding" type="impl:DreddSays">
      <wsdlsoap:binding style="document" transport="http://schemas.xmlsoap.org/soap/http"/>
      <wsdl:operation name="randomQuote">
         <wsdlsoap:operation soapAction=""/>
         <wsdl:input name="randomQuoteRequest">
            <wsdlsoap:body use="literal"/>
         </wsdl:input>
         <wsdl:output name="randomQuoteResponse">
            <wsdlsoap:body use="literal"/>
         </wsdl:output>
      </wsdl:operation>
   </wsdl:binding>
   <wsdl:service name="DreddSaysService">
      <wsdl:port binding="impl:DreddSaysSoapBinding" name="DreddSays">
         <wsdlsoap:address location="http://localhost:8080/Adibidea/services/DreddSays"/>
      </wsdl:port>
   </wsdl:service>
</wsdl:definitions>
</pre>
<p>
El el proyecto web se nos han creado una serie de ficheros para publicar el servicio web. Lo que se hace es usar Apache AXIS en nuestra
aplicación web. Apache AXIS es una implementación del protocolo SOAP sobre el que funcionan los WebServices.</p>
En concreto:
<ul>
<li>WEB-INF/web.xml: se registra el servlet de Apache AXIS</li>
<li>WEB-INF/DreddSays.wsdl: fichero XML con la definición del servicio web.</li>
<li>WEB-INF/server-config.wsdd: fichero con la configuración de servicios que ofrece AXIS, entre otros nuestro WS</li>
<li>WEB-INF/DreddSaysService/info/pello/dredd/deploy.wsdd: fichero con la configuración de nuestro servicio web.</li>
 </ul>
<p>
En el proyecto cliente se nos crean otros ficheros. El que nos interesa es el Proxy: basta con ir a la clase DreddSaysProxy y añadir el método main:

<pre class="brush: java;">
  public static void main (String args[])  {
	  DreddSays dreddSays = new DreddSaysProxy();
	  System.out.println("Dredd says:");
	  try {
		  System.out.println(dreddSays.randomQuote());
	  } catch (RemoteException re) {
		  System.err.println("Remote exception: " + re.getMessage());
	  } catch (Exception e) {
		  System.err.println("Exception: " + e.getMessage());
	  }
	  
  }
</pre>
<p>
El servidor tomcat debe estar iniciado por supuesto, y veremos cómo el servicio web de Dredd nos contesta.
</p>
<pre class="brush: java;">
Dredd says:
Stallone is not the law. I'm the law.
</pre>

